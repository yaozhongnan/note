# 移动端一些概念和问题

## 像素

### 物理像素

物理像素就是手机屏幕的分辨率，出厂的时候就被确定下来，不可修改

### CSS 像素

css 像素是一个抽象的单位，主要使用在浏览器上。在一个标准的显示密度下，一个 CSS 像素对应一个设备像素

### 设备独立像素

设备独立像素是连结 css 像素和 物理像素的一个中介，它会由相关转换关系转换为物理像素

### 位图像素

位图像素是图片的最小数据单元，一个位图像素对应一个物理像素，图片才能得到完美清晰的展示

### 像素比

像素比 = 物理像素 / 设备独立像素

+ iphone6 的像素比 = 750 / 375 = 2

当写上 meta 标签后，width = device-width，使 css 像素与设备独立像素挂钩

即 css 像素等于设备独立像素

1 css 像素 = 4倍物理像素

可以通过 **window.devicePixelRatio** 来获取像素比

## 视口

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
```

### 布局视口

手机为了容纳为 pc 设计的网站，默认的布局视口远大于手机屏幕的宽度

布局视口的出现，在极大程度上帮助了桌面网站到移动设备上的转移。

可以通过document.documentElement.clientWidth来获取 

### 视觉视口

视觉视口语设备屏幕一样宽，并且它的css像素的数量会随用户的缩放而改变

visual viewport的宽度可以通过window.innerWidth 来获取，但在Android 2, Oprea mini 和 UC 8中无法正确获取。

### 理想视口

布局视口的默认宽度并不是一个理想的宽度，对于我们移动设备来说，最理想的情况是用户刚进入页面时不再需要

缩放。这就是为什么苹果和其他效仿苹果的浏览器厂商会引进理想视口！只有是专门为移动设备开发的网站，他才

有理想视口这一说。而且只有当你在页面中加入viewport的meta标签，理想视口才会生效。

```html
<!-- 这行代码表示让 CSS 像素与独立像素挂钩 -->
<meta name="viewport" content="width=device-width" 
```

### 完美视口

在引入理想视口时出现的一个问题，例：在 iphone6 下，将一个 div 的宽度设置为 375px ，占满了整个屏幕，但当该 div 元素的内容超出了盒子的宽度时，没有出现横线滚动条，反而是让视觉视口尽量的把所有超出的内容显示出来。因此，需要使用完美视口

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- 它俩都是改变布局视口大小的，谁大听谁的 -->
```



## em

em 的具体大小跟 body 和 元素的 font-size 有关

如果设置 em 单位的元素没有设置 font-size ，则 ``1em 的大小 = body 的 font-size 大小``

如果设置 em 单位的元素设置了 font-size，则 ``1em 的大小 = 该元素设置的 font-size 的大小``



## rem

rem 的具体大小只跟 html 元素的 font-size 有关，跟元素设置的 font-size 无关

`任何时候 1rem 的大小 = html 的 font-size 大小`



## 适配

### 方案一： rem 适配

rem 适配原理：改变了一个元素在不同设备上占据的 CSS 像素的个数

rem 适配的优点：没有破坏完美视口

rem 适配的缺点：px 值到 rem 的转换太复杂

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
```

```javascript
(function () {
  var styleNode = document.createElement('style');
  var w = document.documentElement.clientWidth / 16 ;
  styleNode.innerHTML = 'html{ font-size: ' + w + 'px!important }' ;
  document.head.appendChild(styleNode);
})()
```

### 方案二：viewport 适配

viewport适配的原理：viewport适配方案中，每一个元素在不同设备上占据的css像素的个数是一样的。但是css像

素和物理像素的比例是不一样的，等比的

优点:所量即所得，直接写设计稿给定的 px 尺寸，缺点:没有使用完美视口

```html
<meta name="viewport" content="width=device-width"/>
```

```javascript
(function(){
  // targetW 代表设计稿的尺寸
  var targetW = 750;
  var scale = document.documentElement.clientWidth/targetW;
  var meta =	document.querySelector("meta[name='viewport']");
  meta.content="initial-scale="+scale+",minimum-scale="+scale+",maximum-scale="+scale+",user-scalable=no";
})()
```

### 方案三：百分比布局

首选百分比布局方案，但当页面元素足够多的时候，百分比布局会显得比较麻烦



## 1  物理像素

### 方案一：淘宝团队解决方案

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
```

```javascript
(function(){
  // 获取像素比，若不支持 devicePixelRatio 则默认为 1
  var dpr  = window.devicePixelRatio || 1;
  var styleNode = document.createElement("style");
  var w = document.documentElement.clientWidth*dpr/16;
  styleNode.innerHTML="html{font-size:"+w+"px!important}";
  document.head.appendChild(styleNode);

  var scale = 1/dpr;
  var meta = document.querySelector("meta[name='viewport']");
  meta.content="width=device-width,initial-scale="+scale+",minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";
})()
```

### 方案二：主流

```css
.border{
  width: 100%;
  height:1px ;
  margin-top: 50px;
  background: black;
}
/* 当像素比为 2 时，高度缩小一倍 */
@media only screen and (-webkit-device-pixel-ratio:2 ) {
  .border{
    transform: scaleY(.5);
  }
}
/* 当像素比为 3 时，高度缩小至三分之一 */
@media only screen and (-webkit-device-pixel-ratio:3 ) {
  .border{
    transform: scaleY(.333333333333333333);
}

```

```html	
<div class='border'></div>
```



## IE6  中最小高度问题

如果一个元素的高度小于 19px 那么在 IE6 中都会显示为 19px ，因为 IE6 中的最小高度为 19px

解决方案，给这个高度小与 19px 的元素的父元素加上 font-size: 0 这个属性

问题：虽然解决了最小高度 19px 的问题，但 IE6 最低只能兼容到 2px，也就是说 1px 高度的元素在 IE6 下最少也是 2px

## 移动端优化

+ 移动端能给高度尽量给高度，减少重构重排





























